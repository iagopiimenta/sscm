<!doctype html>
<html ng-app="app">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/app.css">
  </head>
  <body style="display:none;">
    <nav class="navbar navbar-default navbar-fixed-top navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Trabalho de AOC/AED</a>
        </div>
        <p class="navbar-text navbar-right">Iago</p>
      </div>
    </nav>
    <div class="container" ng-controller="MemoryController">
      <div class="row">
        <div class="col-md-6">
          <form name="setupForm"><!-- http://www.ng-newsletter.com/posts/validations.html -->
            <div class="row">
              <div class="col-md-6 form-group" ng-class="dirtyAndInvalidClass('mainMemorySize')">
                <label class="control-label" for="mainMemorySize">*Tam. da MP(bytes):</label>
                <input ng-disabled="configured" autofocus class="form-control" name="mainMemorySize" ng-model="setup.mainMemorySize" min="1" type="number" required>
                <div ng-messages="setupForm.mainMemorySize.$error" ng-if="dirtyAndInvalidClass('mainMemorySize')">
                  <div ng-messages-include="error-messages"></div>
                </div>
              </div>
              <div class="col-md-6 form-group" ng-class="dirtyAndInvalidClass('mainMemoryBlockSize')">
                <label class="control-label" for="mainMemoryBlockSize">Tam. do Bloco(bytes):</label>
                <input ng-disabled="configured" class="form-control" name="mainMemoryBlockSize" ng-model="setup.mainMemoryBlockSize" min="1" type="number" required>
                <div ng-messages="setupForm.mainMemoryBlockSize.$error" ng-if="dirtyAndInvalidClass('mainMemoryBlockSize')">
                  <div ng-messages-include="error-messages"></div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 form-group" ng-class="dirtyAndInvalidClass('memoryCacheNumberLines')">
                <label for="memoryCacheNumberLines">Qtde de linhas da MC:</label>
                <input ng-disabled="configured" class="form-control" name="memoryCacheNumberLines" ng-model="setup.memoryCacheNumberLines" min="0" type="number" required>
                <div ng-messages="setupForm.memoryCacheNumberLines.$error" ng-if="dirtyAndInvalidClass('memoryCacheNumberLines')">
                  <div ng-messages-include="error-messages"></div>
                </div>
              </div>
              <div class="col-md-6 form-group" ng-class="dirtyAndInvalidClass('memoryCacheN')">
                <label for="memoryCacheN">N:</label>
                <input ng-disabled="configured" class="form-control" name="memoryCacheN" ng-model="setup.memoryCacheN" min="0" type="number" required>
                <div ng-messages="setupForm.memoryCacheN.$error" ng-if="dirtyAndInvalidClass('memoryCacheN')">
                  <div ng-messages-include="error-messages"></div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12 form-group" ng-class="dirtyAndInvalidClass('sequenceBlocks')">
                <label for="numbersInput">Sequencia de acesso aos blocos da MP(separados por espaço):</label>
                <input ng-disabled="configured" class="form-control" name="sequenceBlocks" ng-model="setup.sequenceBlocks" type="text" ng-pattern="/^\d+( \d+)*$/" required>
                <div ng-messages="setupForm.sequenceBlocks.$error" ng-if="dirtyAndInvalidClass('sequenceBlocks')">
                  <div ng-messages-include="error-messages"></div>
                </div>
              </div>
            </div>
            <div class="row">
              <div ng-init="setup.runOnceAllBlocks=true" class="col-md-12 form-group">
                <div class="radio">
                  <label>
                    <input ng-disabled="configured" type="radio" name="runOnceAllBlocks" ng-model="setup.runOnceAllBlocks" ng-value="true">
                    Executar blocos sequencialmente
                  </label>
                </div>
                <div class="radio">
                  <label>
                    <input ng-disabled="configured" type="radio" name="runOnceAllBlocks" ng-model="setup.runOnceAllBlocks" ng-value="false">
                    Executar blocos passo a passo
                  </label>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12 form-group">
                <button ng-show="setup.runOnceAllBlocks" ng-disabled="setupForm.$invalid || configured" class="btn btn-primary" ng-click="runSequence(setup)" type="submit">Executar</button>
                <button ng-hide="setup.runOnceAllBlocks" ng-disabled="setupForm.$invalid || !finishJob || emptySequence" class="btn btn-primary" ng-click="runSequence(setup)" type="submit">Próximo</button>
                <button class="btn btn-danger" ng-click="restart(setup)" type="submit">Reiniciar</button>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="row">
        <hr>
        <div class="col-md-3">
          <table class="table table-striped table-bordered text-center vcenter">
            <thead>
              <tr>
                <th colspan="2" class="text-center">MP</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="block in blocks track by $index">
                <td animate-on-change="blocks[$index]">Bloco {{$index}}</td>
              </tr>
              <tr ng-show="isEmptyMainMemory()">
                <td>Vazia</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-md-3">
          <table class="table table-striped table-bordered text-center vcenter">
            <thead>
              <tr>
                <th colspan="3" class="text-center">MC</th>
              </tr>
              <tr>
                <th class="text-center">Conj.</th>
                <th class="text-center">Linha</th>
                <th class="text-center">Bloco</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="lineGroup in groupLines track by $index">
                <td class="col-md-3">C{{$index}}</td>
                <td colspan="2" class="no-padding">
                  <table class="table table-striped text-center vcenter no-margin">
                    <tbody>
                      <tr ng-repeat="line in numberLinesEachGroup track by $index">
                        <td class="col-md-6" animate-on-change="lineByGroupAndLineGroupNumber($parent.$index, $index)" ngg-class="vm.lineClass($parent.$index, $index)">L{{$index}}</td>
                        <td class="col-md-6" animate-on-change="lineByGroupAndLineGroupNumber($parent.$index, $index)" ngg-class="vm.lineClass($parent.$index, $index)">
                          <span ng-hide="canShowLineBlock($parent.$index, $index)">
                            Nenhum
                          </span>
                          <span ng-show="canShowLineBlock($parent.$index, $index)">
                            Bloco {{currentLine($parent.$index, $index).block}}
                          </span>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </td>
              </tr>
              <tr ng-show="isEmptyMemoryCache()">
                <td colspan="3">Vazia</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-md-6 console">
          <p ng-hide="logs.length > 0">Os logs dos acessos à MP e MC serão mostrados aqui.</p>
          <div ng-repeat="log in logs" ng-show="logs.length > 0">
            <div class="logs" ng-switch on="log.type">
              <div class="log-exist" ng-switch-when="exist">
                <span><span class="log-block-name">Bloco</span> {{log.block}} <span class="log-action">já existe</span> na MC no conj. <span class="log-group">{{log.group}}</span> linha <span class="log-group-line">{{log.groupLine}}</span></span>
              </div>
              <div class="log-overwritten" ng-switch-when="overwritten">
                <span><span class="log-block-name">Bloco</span> {{log.block}} <span class="log-action">copiado</span> para a MC no conj. <span class="log-group">{{log.group}}</span> linha <span class="log-group-line">{{log.groupLine}}</span> <span class="log-overwrite">substituindo</span> o <span class="log-block-name">bloco</span> {{log.oldBlock}}</span>
              </div>
              <div class="log-allocated" ng-switch-default>
                <span><span class="log-block-name">Bloco</span> {{log.block}} <span class="log-action">copiado</span> para a MC no conj. <span class="log-group">{{log.group}}</span> linha <span class="log-group-line">{{log.groupLine}}</span></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="text/ng-template" id="error-messages">
      <small ng-message="required" class="help-block">Este campo é obrigatório</small>
      <small ng-message="number" class="help-block">Digite apenas números</small>
      <small ng-message="min" class="help-block">Valor muito baixo</small>
      <small ng-message="pattern" class="help-block">Sequência inválida</small>
    </script>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="bower_components/angular/angular.js"></script>
    <script src="bower_components/angular-messages/angular-messages.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
